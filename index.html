<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blox GPT</title>
  <style>
    body {
      background: radial-gradient(1200px at center top, #0a0020, #050010);
      color: #fff;
      font-family: Poppins, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 40px 20px;
      min-height: 100vh;
    }
    h1 {
      font-size: 64px;
      font-weight: 900;
      background: linear-gradient(90deg, #00eaff, #ff00f7, #ffef00, #00ff9d, #00eaff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 400% 400%;
      animation: hue 5s linear infinite;
      text-shadow: 0 0 25px rgba(0, 234, 255, 0.3);
      margin: 0;
    }
    @keyframes hue {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    p.subtitle {
      color: #aefcff;
      font-size: 22px;
      margin-top: 6px;
      text-shadow: 0 0 10px rgba(0,255,255,.25);
    }
    #chat-box {
      width: 900px;
      max-width: 94vw;
      height: 420px;
      background: rgba(15, 15, 40, 0.7);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.08);
      box-shadow: inset 0 0 25px rgba(0,234,255,0.15);
      padding: 16px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .msg {
      padding: 10px 14px;
      margin: 8px 0;
      border-radius: 12px;
      max-width: 80%;
      white-space: pre-wrap;
    }
    .user {
      background: rgba(0,234,255,0.15);
      margin-left: auto;
    }
    .bot {
      background: rgba(255,0,247,0.10);
      border: 1px solid rgba(255,0,247,0.25);
    }
    .input-area {
      display: flex;
      gap: 10px;
      justify-content: center;
      width: 900px;
      max-width: 94vw;
      margin-top: 12px;
    }
    .input-area input {
      flex: 1;
      padding: 14px;
      border-radius: 12px;
      background: rgba(20,20,50,.8);
      border: 1px solid rgba(255,255,255,.12);
      color: #fff;
      font-size: 16px;
      outline: none;
    }
    .input-area button {
      padding: 14px 22px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(90deg, #00eaff, #ff00f7, #ffef00);
      color: #050010;
      font-weight: 800;
      cursor: pointer;
      transition: 0.15s;
    }
    .input-area button:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 25px rgba(0,234,255,.5);
    }
    .hint {
      text-align: center;
      margin-top: 14px;
      color: #bfefff;
      opacity: .8;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>Blox GPT</h1>
  <p class="subtitle">Specialized in Blox Fruits PvP</p>

  <div id="chat-box">
    <div class="msg bot">
      Yo bro üëã I‚Äôm Blox GPT ‚Äî your PvP assistant! Ask me anything about Blox Fruits combos, playstyles, or meta tips.
    </div>
  </div>

  <div class="input-area">
    <input id="user-input" placeholder="Type your message..." />
    <button id="send-btn">Send</button>
  </div>

  <p class="hint">
    Try: ‚Äúteach me ken tricking‚Äù ‚Ä¢ ‚Äúpassive vs aggressive‚Äù ‚Ä¢ ‚Äúcounter dough‚Äù ‚Ä¢ ‚Äúportal combo (mobile)‚Äù ‚Ä¢ ‚Äúelaborate‚Äù
  </p>

  <script>
    <script>
/* ---------------- Blox GPT ‚Äî fast, accurate, KB-guided ---------------- */

// UI helpers
const chatBox = document.getElementById("chat-box");
const input   = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = `msg ${role}`;
  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function addTyping() {
  const t = document.createElement("div");
  t.className = "msg bot";
  t.textContent = "‚Ä¶";
  chatBox.appendChild(t);
  chatBox.scrollTop = chatBox.scrollHeight;
  return () => t.remove();
}

// ---------- ‚ÄúSystem prompt‚Äù rules (accuracy + tone) ----------
const SYSTEM = `
You are Blox GPT, a friendly PvP mentor for Blox Fruits.
Be clear, concise, and correct. Never invent mechanics:
‚Ä¢ Aura/Haki: lets you hit Elementals; it does NOT buff damage.
‚Ä¢ Instinct (Ken): helps dodging/reading; it does NOT add stats.
‚Ä¢ Ken Tricking: timing ON/OFF to survive combos and escape.
‚Ä¢ Portal cannot ‚Äúchat with others‚Äù; stick to movement & traps.
‚Ä¢ Prefer short actionable steps + one tip. If asked to elaborate, go deeper.
When a user asks for fruit-specific help, give a combo or 2 counters + a punish window.
`;

// ---------- Load optional KB (fast; safe if missing) ----------
let KB = { combos: [], counters: [], builds: [], guides: {} };
(async () => {
  try {
    const r = await fetch("./kb/blox_pvp.json", { cache: "no-store" });
    if (r.ok) KB = await r.json();
  } catch { /* ok if missing */ }
})();

// ---------- Tiny retrieval over KB (super fast) ----------
const norm = s => (s||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").replace(/\s+/g," ").trim();

function makeCorpus() {
  const C = [];
  (KB.combos||[]).forEach(c=>{
    C.push({title:`Combo: ${c.title}`, text:`${(c.inputs||[]).join(" ‚Üí ")} | ${(c.notes||[]).join(" | ")}`, key:norm(`${c.title} ${(c.inputs||[]).join(" ")} ${(c.notes||[]).join(" ")}`)});
  });
  (KB.counters||[]).forEach(ct=>{
    C.push({title:`Counter vs ${ct.enemy||"?"}`, text:(ct.tips||[]).join(" | "), key:norm(`${ct.enemy} ${(ct.tips||[]).join(" ")}`)});
  });
  (KB.builds||[]).forEach(b=>{
    C.push({title:`Build: ${b.label||"?"}`, text:(b.notes||[]).join(" | "), key:norm(`${b.label} ${(b.notes||[]).join(" ")}`)});
  });
  if (KB.guides?.theory) C.push({title:"PvP Theory", text:KB.guides.theory, key:norm(KB.guides.theory)});
  return C;
}
function retrieve(q, k=4) {
  const C = makeCorpus();
  const n = norm(q);
  const hits = C.filter(x=>x.key.includes(n)).slice(0,k);
  if (!hits.length && KB.guides?.theory) return `Context ‚Äî PvP Theory: ${KB.guides.theory.slice(0,600)}`;
  return hits.map(h=>`${h.title}: ${h.text}`).join("\n");
}

// ---------- Fast intent engine + accuracy guards ----------
let lastIntent = null;
const N = s => (s||"").toLowerCase();

function reply(raw){
  const q = N(raw);

  // sanity/accuracy guards
  if (/sprite\b/.test(q)) return "There‚Äôs no Sprite race in Blox Fruits. Stick to Angel, Cyborg, Draco, Ghoul, Rabbit, etc.";
  if (/haki|aura/.test(q)) return "Aura (Haki) lets you hit Elemental users ‚Äî it doesn‚Äôt add damage. Keep it on in PvP to bypass Elementals.";
  if (/instinct\b/.test(q) && !/ken|trick/.test(q)) return "Instinct helps with dodging/reading. Use **Ken Tricking** (toggle ON/OFF with timing) to survive combos and escape.";

  // greetings/small talk
  if (/(yo|hey|hello|hi|wsp|sup)\b/.test(q)) {
    lastIntent = "greet";
    return "Yo! Wanna work on **combos**, **counters**, **Ken Tricking**, or **playstyle drills**?";
  }
  if (/(thanks|thank you|ur cool|you're cool|nice|love u)/.test(q)) {
    lastIntent = "nice";
    return "Appreciate it üòé now let‚Äôs cook some PvP wins.";
  }

  // playstyles
  if (/(passive|aggressive)(.*playstyle|style)?/.test(q)) {
    lastIntent = "playstyles";
    return [
      "üî• **Passive vs Aggressive**",
      "‚Ä¢ **Aggressive**: Rushdown. Fast starters, break Ken, punish endlag instantly.",
      "‚Ä¢ **Passive**: Bait and punish. Keep spacing, poke at range, counter on whiff.",
      "üëâ Mix both mid-fight so you‚Äôre unpredictable."
    ].join("\n");
  }

  // Ken Tricking
  if (/ken.?trick|instinct trick|teach.*ken/.test(q)) {
    lastIntent = "kentrick";
    return [
      "‚ö° **Ken Tricking (how-to)**",
      "1) Keep Instinct **OFF**.",
      "2) Toggle **ON** right as a multi-hit/stun starts to absorb safely.",
      "3) Toggle **OFF** instantly to save dodges.",
      "4) Counter during endlag (e.g., GH Z ‚Üí C ‚Üí X).",
      "Practice vs Dough V / Ice V / Rumble to learn timings."
    ].join("\n");
  }

  // elaborate
  if (/elaborate|more detail|go deeper|explain more|detail/.test(q)) {
    if (lastIntent === "kentrick") {
      return [
        "üí• **Ken Tricking ‚Äî deeper**",
        "‚Ä¢ Watch animation/sound cues; don‚Äôt spam toggles.",
        "‚Ä¢ Time it for big AoEs (Dragon C / Dough V).",
        "‚Ä¢ After a baited hit: dash-cancel ‚Üí starter (Trident X / GH Z).",
        "‚Ä¢ Cyborg V4 can break Ken loops ‚Äî disengage and reset spacing."
      ].join("\n");
    }
    if (lastIntent === "playstyles") {
      return [
        "üß© **Drills**",
        "‚Ä¢ Aggro: 10 rounds forcing first engage; punish every endlag.",
        "‚Ä¢ Passive: 10 rounds only reacting ‚Äî no first strike.",
        "‚Ä¢ Review 1 mistake per round and fix it next."
      ].join("\n");
    }
    return "Tell me what to go deeper on ‚Äî **Ken Tricking**, **playstyles**, **combos**, or **counters**?";
  }

  // combos
  if (/combo|route/.test(q) || /portal.*combo/.test(q)) {
    lastIntent = "combos";
    if (/portal/.test(q)) {
      return [
        "üåÄ **Portal (mobile-friendly)**",
        "Portal **Z** ‚Üí Shark Anchor **Z** ‚Üí Sanguine **Z** ‚Üí **C** ‚Üí **X**",
        "Tip: keep camera level after Anchor Z so Sanguine connects clean."
      ].join("\n");
    }
    // Try KB retrieval first
    const ctx = retrieve(q);
    if (ctx) {
      return [
        "‚öîÔ∏è **Combos**",
        ctx,
        "Ask for your fruit and I‚Äôll tailor it."
      ].join("\n");
    }
    return [
      "‚öîÔ∏è **Try these**",
      "‚Ä¢ Sand C ‚Üí Sand V ‚Üí Anchor Z ‚Üí Anchor X ‚Üí Sanguine Z ‚Üí C ‚Üí X",
      "‚Ä¢ Ice V ‚Üí Unawakened Ice C ‚Üí Ice Z ‚Üí GH X ‚Üí GH Z ‚Üí GH C",
      "‚Ä¢ DT X ‚Üí Dough V ‚Üí Dough X ‚Üí Dough C ‚Üí EClaw C ‚Üí EClaw X",
      "Say your fruit and I‚Äôll tailor it."
    ].join("\n");
  }

  // counters
  if (/counter|how to beat|how do i beat|\bvs\b/.test(q)) {
    lastIntent = "counters";
    if (/\bbuddha\b/.test(q)) {
      return "üôè **Vs Buddha** ‚Äî stay out of M1 range; poke from distance; air-camp if needed; punish after Z endlag. Don‚Äôt chase ‚Äî make them whiff first.";
    }
    if (/\bdough\b/.test(q)) {
      return "üç© **Vs Dough** ‚Äî stay airborne; many routes are ground-based. Cyborg V4 Aftershock can interrupt. Wait for animation endlag; punish fast.";
    }
    if (/\bice\b/.test(q)) {
      return "‚ùÑÔ∏è **Vs Ice** ‚Äî avoid ground trades; fight in the air; punish missed Z/V with a quick starter (Trident X / GH Z).";
    }
    if (/\bportal\b/.test(q)) {
      return "üåÄ **Vs Portal** ‚Äî don‚Äôt chase teleports; hold your starter for their Rift recovery; punish after V trap if they miss.";
    }
    // KB retrieval for unknown target
    const ctx = retrieve(q);
    if (ctx) return ctx;
    return "Who you fighting ‚Äî **Buddha**, **Dough**, **Ice**, **Portal**, or someone else?";
  }

  // ask for fruit/build
  if (/build|stat|distribution|accessor|gear/.test(q)) {
    const ctx = retrieve("build");
    return ctx || "General rule: Max your main damage stat (Fruit/Sword/Gun) + Melee (energy) + Defense (HP). Pick accessories for mobility/dodges.";
  }

  // default with system guard
  lastIntent = "misc";
  return "Bet bro üí™ ask me about **combos**, **counters**, **Ken Tricking**, or **playstyles**. If you want, say your **fruit/race** and I‚Äôll tailor it.";
}

// ---------- Wire up (fast; uses tiny artificial delay for vibe) ----------
function sendNow(){
  const text = input.value.trim();
  if (!text) return;
  addMessage("user", text);
  input.value = "";
  const done = addTyping(); // show quick typing bubble
  // generate fast (no heavy compute)
  setTimeout(()=>{
    const sys = SYSTEM.trim().length ? "" : ""; // (kept for clarity; no external LLM used)
    const out = reply(text);
    done();
    addMessage("bot", out);
  }, 120);
}

sendBtn.addEventListener("click", sendNow);
input.addEventListener("keydown", e => { if (e.key === "Enter") sendNow(); });
</script>


